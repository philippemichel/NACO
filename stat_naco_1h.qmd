---
title: "Stop NACO"
subtitle: "Rapport Statistique - V 1.0"
lang: fr
language:
  title-block-author-single: "Auteur"
author:
  - name: "D<sup>r</sup> Philippe MICHEL"
    orcid: "0000-0003-2392-7186"
    email: "philippe.michel@ght-novo.fr"
    role: "Statisticien"
    affiliations:
      name: "USRC - H\u00f4pital NOVO"
      city: Pontoise
      department: "Unit\u00e9 de Soutien à la Recherche Clinique"
title-block-banner: true
format:
  html:
    embed-resources: true
    theme: minty
    code-fold: true
    html-math-method: katex
    highlight-style: ayu
    page-layout: full
    toc: true
    number-sections: true
    smooth-scroll: true
    citation-hover: true
bibliography: stat.bib
# csl: jama.csl
license: "MIT"
warning: false
message: false
cache: false
---

::: {.panel-tabset}


# Introduction


 Investigateur principal :M<sup>me</sup> Fanny TORTELIER
 
 Responsable scientifique : D<sup>r</sup> Amélie TOUSSAINT -- Service d’Anesthésie-Réanimation -- Hôpital NOVO (Site Pontoise)
 
 Chef de projet : M<sup>me</sup> Véronique \\textsc{DA COSTA}
 
**Évaluer l’intérêt d’une procédure de service de gestion des NACO dans la prise en charge des fractures de l’extrémité supérieure du fémur.**
 
Étude monocentrique rétrospective et prospective à témoin historique.



```{r}
#| label: setup

rm(list = ls())
#
library(baseph)
library(janitor)
library(tidyverse)
library(gtsummary)
library(kableExtra)
library(lubridate)
library(kableExtra)
library(forestmodel)
library(labelled)
library(epiDisplay)
library(visdat)
library(GGally)
library(ggridges)
library(colorspace)
library(xlsx)
library(apyramid)
library(plotly)
#
theme_gtsummary_language(language = "fr", decimal.mark = ",")
options(OutDec = ",")
#
load("datas/stopnaco.RData")
expx <- FALSE
classeur <- "copsca1.xls"
if (expx){system(paste0("rm -f ",classeur))}
#
cat <- list(all_continuous() ~ "t.test", all_categorical() ~ "chisq.test")
```

## Technique 

Les données discrètes ont été présentés en pourcentage puis comparées par le test du $\Chi^2$ de Pearson avec correction de Yates si nécessaire. Les données numériques ont été présentées par leur médiane & les quartiles puis comparées par le test non paramétrique de Wilcoxon. 

L'analyse statistique a été réalisée avec le logiciel **R** [@rstat] & diverses librairies en particulier celles du `tidyverse` [@tidy] & `baseph` [@baseph]. Le flux a été géré grâce à la librairie `WORCS` [@worcs].

# Description de la population

```{r}
#| label: nb-cas

ncas <- nrow(tt)
zz <- tt |> 
  group_by(groupe) |> 
  count()

```


L'échantillon comporte `r nrow(tt)` cas  dont `r zz$n[1]` dans le groupe `avant` et `r zz$n[2]` dans le groupe `après`.



## Démographie

```{r}
#| label: tbl-demog
#| tbl-cap: Données démographiques

tt |>
dplyr::select(2,3,9:20,59:63, groupe) |>
tbl_summary(missing = "no", 
              by = groupe,
            statistic = list(all_continuous() ~ "{mean} ({sd})", all_continuous() ~ "{mean} ({sd})")) |>
modify_header(label ~ " ") |>
  add_p(test = cat) |>
  add_overall() |>
bold_labels() |>
pexptabph(nomfich = classeur,
nomsheet = "demog1",
exp = expx) 
```

La seule différence gênante est l'évolution du score ASA qui semble plus élevé dans la seconde période.

```{r}
#| label: fig-ages
#| fig-cap: Pyramide des âges

tt |>
# Tracé du graphique
age_pyramid(age_group = "agerec",
            split_by = "sexe",
            pal = c("pink", "lightblue"),
show_midpoint = FALSE) +
theme_light() +
    labs(title = "Pyramide des âges",
        fill = "Sexe")+ 
    theme(
      plot.title = element_text(size = 16, face = "bold"),
      plot.subtitle = element_text(size = 12),
      axis.title.x = element_blank(),
      axis.title.y = element_blank(),
      legend.title = element_blank(),
      legend.position = "bottom") 
```

## Modification des pratiques 

On vérifie que dans la seconde période les pratiques se sont réellement modifiées. 




# Critère principal
*mettre en évidence une réduction du délai de prise en charge chirurgicale de la FESF par la mise en place d’un ajustement du seuil préopératoire du dosage des NACO suite à une procédure collégiale en septembre 2021.*


```{r}
#| label: tbl-delai1
#| tbl-cap: Délai admission-bloc


tt |>
dplyr::select(delai_chirurgical, groupe, delai48) |>
tbl_summary(missing = "no", 
            by = groupe,
            statistic = list(all_continuous() ~ "{mean} ({sd})")) |> 
modify_header(label ~ " ") |>
add_p(test = cat) |>
add_overall() |>
bold_labels() |>
pexptabph(nomfich = classeur,
nomsheet = "delai1",
exp = expx) 
```

```{r}
#| label: fig-delai1
#| fig-cap: Délai admission-bloc

tt |> 
  ggplot() +
  aes(y = delai_chirurgical, x = groupe, fill = groupe) +
  geom_violin() +
  geom_boxplot(width = 0.2, fill = "grey90") +
  labs(title = "Délai admission-bloc",
         x = "Période",
         y = "heures") +
  geom_hline(yintercept = 48, linetype = "dotdash", col = "grey40") +
    theme_light() +
    colorspace::scale_fill_discrete_qualitative(palette = "Dark 3") +
    theme(
      plot.title = element_text(size = 16, face = "bold"),
      plot.subtitle = element_text(size = 12),
      axis.title.x = element_text(size = 12),
      legend.title = element_text(size = 12),
      axis.title.y = element_text(
        size = 12,
        angle = 90,
        vjust = .5
      ),
      axis.text.x = element_text(size = 12),
      axis.text.y = element_text(size = 12),
      legend.position = "none"
    )
```

## Facteurs influants

```{r}
#| label: tbl-fact1
#| tbl-cap: Facteurs influants le délai chirurgical 

tt |>
tbl_continuous(variable = delai_chirurgical, include = c(groupe, score_asa, 87,3,9:15,17:20,59:63)
               ) |>
add_p(test = list(all_continuous() ~ "t.test")) |> 
bold_labels() |>
  modify_header(label ~ " ") |>
pexptabph(nomfich = classeur,
nomsheet = "fact1",
exp = expx) 
```

```{r}
#| label: tbl-fact2
#| tbl-cap: acteurs influants le délai chirurgical

lm(delai_chirurgical ~ groupe + score_asa + agerec + adl_avant+ type_fracture ,data = tt) |> 
  tbl_regression() |> 
  bold_labels() |>
  modify_header(label ~ " ") |>
pexptabph(nomfich = classeur,
nomsheet = "fact2",
exp = expx) 
```

Une interaction forte entre l'âge & l'a vie en institution entre autres a obligé à limiter les variables dans le modèle de régression. La période ne semble pas influencer le délai chirurgical (p = 0.3). Les facteurs influant sont l'âge , le score ADL (p = 0,01) et le type de fracture (p = 0.01). Le délai semble plus court chez les patients ASA 2 ou 3 que 4.



# Critères secondaires 1
*Mesure de l’impact de la nouvelle stratégie*


## Pertes sanguines estimées en per opératoire

```{r}
#| label: tbl-pertes1
#| tbl-cap: Pertes sanguines estimées en per opératoire

tt |>
tbl_continuous(variable = pertes_sanguines_estimees, include = c(groupe, ddosage_rec, score_asa)
               ) |>
add_p(test = list(everything() ~ "aov")) |> 
bold_labels() |>
  modify_header(label ~ " ") |>
pexptabph(nomfich = classeur,
nomsheet = "pertes1",
exp = expx) 

```

```{r}
#| label: tbl-pertes2
#| tbl-cap: Pertes sanguines estimées en per opératoire

lm(pertes_sanguines_estimees~groupe + ddosage_rec +score_asa, data = tt) |> 
    tbl_regression() |> 
  bold_labels() |>
  modify_header(label ~ " ") |>
pexptabph(nomfich = classeur,
nomsheet = "pertes2",
exp = expx)
```


Le saignement per-opératoire ne semble pas être influencé par le dernier dosage des NACO (sauf si > 100) ou la période. 

```{r}
#| label: fig-pertes1
#| fig-cap: Pertes sanguines estimées en per opératoire & dosage antiXa

tt |> 
  drop_na(ddosage_rec) |>
  ggplot() +
  aes(y = pertes_sanguines_estimees, x = ddosage_rec, fill = ddosage_rec) +
  geom_violin() +
  geom_boxplot(width = 0.2, fill = "grey90") +
  labs(title = "Délai admission-bloc",
         x = "Dernier dosage",
         y = "Pertes sanguines estimées (cc)") +
  geom_hline(yintercept = 48, linetype = "dotdash", col = "grey40") +
    theme_light() +
    colorspace::scale_fill_discrete_qualitative(palette = "Dark 3") +
    theme(
      plot.title = element_text(size = 16, face = "bold"),
      plot.subtitle = element_text(size = 12),
      axis.title.x = element_text(size = 12),
      legend.title = element_text(size = 12),
      axis.title.y = element_text(
        size = 12,
        angle = 90,
        vjust = .5
      ),
      axis.text.x = element_text(size = 12),
      axis.text.y = element_text(size = 12),
      legend.position = "none"
    )
```


## Transfusion

 
### Transfusion sanguine selon la période
 
```{r}
#| label: tbl-transfu1
#| tbl-cap: Transfusion sanguine 


tt |>
dplyr::select(groupe, 64 :71) |>
tbl_summary(missing = "no", 
            by = groupe,
            statistic = list(all_continuous() ~ "{mean} ({sd})")) |> 
modify_header(label ~ " ") |>
add_p(test = cat) |>
add_overall() |>
bold_labels() |>
pexptabph(nomfich = classeur,
nomsheet = "transfu1",
exp = expx) 
```     

Il n'y a pas de différence entre les deux périodes pour les transfusions sanguines ou autre traitement de l'hémorragie.
      
### Transfusion sanguine & dernier dosage

```{r}
#| label: tbl-transfu2
#| tbl-cap: Transfusion sanguine & dernier dosage


tt |>
dplyr::select(ddosage_rec, 64 :71) |>
tbl_summary(missing = "no", 
            by = ddosage_rec,
            statistic = list(all_continuous() ~ "{mean} ({sd})")) |> 
modify_header(label ~ " ") |>
add_p(test = cat) |>
add_overall() |>
bold_labels() |>
pexptabph(nomfich = classeur,
nomsheet = "transfu1",
exp = expx) 
```     

Il n'y a pas de différence pour les transfusions sanguines ou autre traitement de l'hémorragie selon le dernier dosage pré-op des NACOs.

## Morbi-mortalité hospitalière

```{r}
#| label: tbl-morbi
#| tbl-cap: Morbi-mortalité hospitalière


tt |>
dplyr::select(groupe, 78:81, readmission_j_30, deces_intra_hospitalier) |>
tbl_summary(missing = "no", 
            by = groupe,
            statistic = list(all_continuous() ~ "{mean} ({sd})")) |> 
modify_header(label ~ " ") |>
add_p(test = cat) |>
add_overall() |>
bold_labels() |>
pexptabph(nomfich = classeur,
nomsheet = "morbi",
exp = expx) 
```     


# Critères secondaires 2
*Facteurs impactant la prise en charge*

## Complications du décubitus dorsal
## Complications du décubitus dorsal (Les escarres ...)
## Facteurs liés au terrain pré-existant 
## Jour d’admission sur la prise en charge (week-end/jour férié/garde)




:::
